extends base

block content
  main.main
    .user-view
      nav.user-view__menu
        ul.side-nav
          +navItem('/me', 'Settings', 'settings')
          +navItem('#', 'My bookings', 'briefcase')
          +navItem('#', 'My reviews', 'star')
          +navItem('#', 'Billing', 'credit-card')

        - if (user.role === 'admin')
          .admin-nav
            h5.admin-nav__heading Admin
            ul.side-nav
              +navItem('/manage-tours', 'Manage tours', 'map')
              +navItem('/manage-users', 'Manage users', 'users', true)
              +navItem('/manage-reviews', 'Manage reviews', 'star')
              +navItem('#', 'Manage bookings', 'briefcase')

      .user-view__content
        .manage-users-container
          .flex-header
            h2.heading-secondary Manage Users (#{results})

            //- FILTER & SORT FORM
            form.filter-form(method='GET' action='/manage-users')
              .filter-group
                label(for='role') Role:
                select#role(name='role')
                  option(value='all' selected=currentRole==='all') All Roles
                  option(value='user' selected=currentRole==='user') User
                  option(value='guide' selected=currentRole==='guide') Guide
                  option(value='lead-guide' selected=currentRole==='lead-guide') Lead Guide
                  option(value='admin' selected=currentRole==='admin') Admin

              .filter-group
                label(for='sort') Sort by:
                select#sort(name='sort')
                  option(value='name-asc' selected=currentSort==='name-asc') Name (A-Z)
                  option(value='name-desc' selected=currentSort==='name-desc') Name (Z-A)
                  option(value='newest' selected=currentSort==='newest') Newest First
                  option(value='oldest' selected=currentSort==='oldest') Oldest First

          if users.length > 0
            .table-wrapper
              table.manage-table
                thead
                  tr
                    th User
                    th Role
                    th Status
                    th Actions
                tbody
                  each user in users
                    tr
                      td
                        .user-cell
                          img.manage-user-photo(src=`/img/users/${user.photo}`, alt=`Photo of ${user.name}`)
                          .user-details
                            span.user-name= user.name
                            span.user-email= user.email
                      td
                        span.role-badge(class=`role-${user.role}`)= user.role
                      td
                        - const status = user.active ? 'active' : 'inactive';
                        span.status-badge(class=`status-${status}`)= status
                      td
                        a.btn-text.edit-user(href='#') Edit
                        |
                        a.btn-text.delete-user(href='#' data-user-id=user.id) Delete

            //- PAGINATION (Updated to preserve filters)
            if totalPages > 1
              .pagination
                - const baseLink = `?role=${currentRole}&sort=${currentSort}`

                if currentPage > 1
                  a.pagination__link(href=`${baseLink}&page=${currentPage - 1}`)
                    svg.pagination__icon
                      use(xlink:href='/img/icons.svg#icon-chevron-left')
                    span Prev
                else
                  span.pagination__link.pagination__link--disabled
                    svg.pagination__icon
                      use(xlink:href='/img/icons.svg#icon-chevron-left')
                    span Prev

                span.pagination__text Page #{currentPage} of #{totalPages}

                if currentPage < totalPages
                  a.pagination__link(href=`${baseLink}&page=${currentPage + 1}`)
                    span Next
                    svg.pagination__icon
                      use(xlink:href='/img/icons.svg#icon-chevron-right')
                else
                  span.pagination__link.pagination__link--disabled
                    span Next
                    svg.pagination__icon
                      use(xlink:href='/img/icons.svg#icon-chevron-right')
          else
            .no-results
              h2 No users found matching your criteria.
              a.btn-text(href='/manage-users') Clear Filters